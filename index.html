<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Compras - Casa Rural</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="container">
        <div class="welcome-message">
            <h1>Gestión de la compra - Casa Rural</h1>
        </div>

        <div class="table-container">
            <h2>Lista de compras</h2>
            <div id="loading" class="loading">Cargando...</div>
            <div id="error" class="error" style="display: none;"></div>
            <table id="dataTable" style="display: none;">
                <thead>
                    <tr id="tableHeader"></tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
    </div>

    <script>
        // URL del CSV de Google Sheets
        const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTzU3A2YW5jGO4jF0lGpfEnJGCuUEOs1dKCl7zPVZma60j1sityN2DNhXW9RwJpEecyq-wUXow_5mtO/pub?output=csv";

        // Función para parsear CSV
        function parseCSV(text) {
            const lines = text.split('\n');
            const result = [];

            for (let line of lines) {
                if (line.trim()) {
                    // Simple CSV parsing - handles basic cases
                    const row = line.split(',').map(cell => cell.trim().replace(/^"|"$/g, ''));
                    result.push(row);
                }
            }

            return result;
        }

        // Función para crear la tabla
        function createTable(data) {
            const table = document.getElementById('dataTable');
            const header = document.getElementById('tableHeader');
            const body = document.getElementById('tableBody');

            // Limpiar contenido anterior
            header.innerHTML = '';
            body.innerHTML = '';

            if (data.length === 0) {
                showError('No hay datos disponibles');
                return;
            }

            // Crear encabezados (primera fila)
            const headerRow = data[0];
            headerRow.forEach(cellData => {
                const th = document.createElement('th');
                th.textContent = cellData;
                header.appendChild(th);
            });

            // Crear filas de datos (resto de filas)
            for (let i = 1; i < data.length; i++) {
                const row = data[i];
                const tr = document.createElement('tr');

                row.forEach(cellData => {
                    const td = document.createElement('td');
                    td.textContent = cellData || '';
                    tr.appendChild(td);
                });

                body.appendChild(tr);
            }

            // Mostrar tabla
            hideLoading();
            table.style.display = 'table';
        }

        // Función para mostrar loading
        function showLoading() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('error').style.display = 'none';
            document.getElementById('dataTable').style.display = 'none';
        }

        // Función para ocultar loading
        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        // Función para mostrar error
        function showError(message) {
            hideLoading();
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        // Función para cargar datos
        async function loadData() {
            showLoading();

            try {
                const response = await fetch(CSV_URL);

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const csvText = await response.text();
                const data = parseCSV(csvText);
                createTable(data);

            } catch (error) {
                console.error('Error loading data:', error);
                showError('Error al cargar los datos');
            }
        }

        // Cargar datos cuando la página esté lista
        document.addEventListener('DOMContentLoaded', loadData);
    </script>
</body>

</html>